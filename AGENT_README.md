# å·¥è‰ºæˆæœ¬æ™ºèƒ½ Agent ä½¿ç”¨è¯´æ˜

## ğŸ“‹ ç›®å½•
- [åŠŸèƒ½ä»‹ç»](#åŠŸèƒ½ä»‹ç»)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ä½¿ç”¨æ–¹å¼](#ä½¿ç”¨æ–¹å¼)
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [ç¤ºä¾‹åœºæ™¯](#ç¤ºä¾‹åœºæ™¯)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ¯ åŠŸèƒ½ä»‹ç»

å°† `process_rate_finder_tool` å°è£…æˆæ™ºèƒ½å¯¹è¯ Agentï¼Œå…·å¤‡ä»¥ä¸‹èƒ½åŠ›ï¼š

- âœ… **å¯¹è¯å¼æŸ¥è¯¢**: è‡ªç„¶è¯­è¨€äº¤äº’ï¼Œæ— éœ€è®°å¿†å‚æ•°æ ¼å¼
- âœ… **æ™ºèƒ½è¡¥å…¨**: è‡ªåŠ¨æ¨ç†ç¼ºå¤±å‚æ•°æˆ–å¼•å¯¼ç”¨æˆ·æä¾›
- âœ… **å¤šè½®å¯¹è¯**: æ”¯æŒä¸Šä¸‹æ–‡è®°å¿†ï¼Œè¿ç»­å¯¹è¯
- âœ… **æ ¼å¼åŒ–è¾“å‡º**: æ¸…æ™°å±•ç¤ºæˆæœ¬åˆ†è§£å’Œæ¨ç†è¿‡ç¨‹
- âœ… **çµæ´»é€‚é…**: æ”¯æŒ CNY/hã€CNY/cmÂ³ã€CNY/kg ä¸‰ç§è®¡è´¹å•ä½

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

ç¡®ä¿ `.env` æ–‡ä»¶åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```env
# Azure OpenAI é…ç½®
AZURE_OPENAI_DEPLOYMENT=your-deployment-name
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_ENDPOINT=https://your-endpoint.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# Tavily æœç´¢
TAVILY_API_KEY=your-tavily-key

# ä»£ç†ï¼ˆå¯é€‰ï¼‰
PROXY_URL=http://user:password@proxy.company.com:8080
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install langchain langchain-openai langchain-core python-dotenv
```

### 3. è¿è¡Œ Agent

#### æ–¹å¼ 1: äº¤äº’å¼å¯¹è¯ï¼ˆæ¨èï¼‰
```bash
python interactive_agent.py
```

#### æ–¹å¼ 2: è„šæœ¬æµ‹è¯•
```bash
python process_cost_agent.py
```

---

## ğŸ’¬ ä½¿ç”¨æ–¹å¼

### äº¤äº’å¼å‘½ä»¤

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| `help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `reset` | é‡ç½®å¯¹è¯å†å² |
| `quit` / `exit` | é€€å‡ºç¨‹åº |

### å¯¹è¯ç¤ºä¾‹

#### åœºæ™¯ 1: å®Œæ•´å‚æ•°æŸ¥è¯¢
```
ğŸ‘¤ ä½ : å¸®æˆ‘æŸ¥è¯¢å®æ³¢åœ°åŒº AlSi9Mn ææ–™çš„ Trimming å·¥è‰ºæˆæœ¬ï¼Œ
     è¡¨é¢ç§¯ 3110 cmÂ²ï¼Œä½“ç§¯ 195.6 cmÂ³ï¼Œå¹´äº§é‡ 110 ä¸‡ä»¶ï¼ŒæŒ‰å°æ—¶è®¡è´¹

ğŸ¤– Agent: [è°ƒç”¨å·¥å…·æŸ¥è¯¢...]
ğŸ“Š æˆæœ¬æŸ¥è¯¢ç»“æœ
--------------------------------------------------
ğŸ” æŸ¥è¯¢å‚æ•°:
  â€¢ åœ°åŒº: Ningbo, Zhejiang
  â€¢ å·¥è‰º: Trimming
  â€¢ ææ–™: AlSi9Mn
  ...
ğŸ’° æˆæœ¬ä¼°ç®—:
  â€¢ æœ€ç»ˆæˆæœ¬: 150.00 CNY/h
  â€¢ åŸºç¡€å°æ—¶æˆæœ¬: 150.00 CNY/h
ğŸ“‹ æˆæœ¬åˆ†è§£ (CNY/h):
  â€¢ äººå·¥: 45.00
  â€¢ èƒ½æº: 35.00
  â€¢ è®¾å¤‡æŠ˜æ—§: 70.00
```

#### åœºæ™¯ 2: ç¼ºå°‘å‚æ•°ï¼ŒAgent å¼•å¯¼
```
ğŸ‘¤ ä½ : å¸®æˆ‘ç®—ä¸€ä¸‹å®æ³¢çš„å‹é“¸æˆæœ¬

ğŸ¤– Agent: å¥½çš„ï¼Œæˆ‘éœ€è¦ä¸€äº›é¢å¤–ä¿¡æ¯ï¼š
  1. ææ–™æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¦‚ AlSi9Mn, ADC12 ç­‰ï¼‰
  2. é›¶ä»¶çš„è¡¨é¢ç§¯å’Œä½“ç§¯æ˜¯å¤šå°‘ï¼Ÿ
  3. å¹´äº§é‡æ˜¯å¤šå°‘ï¼Ÿ
  4. å¸Œæœ›æŒ‰ä»€ä¹ˆå•ä½è®¡è´¹ï¼Ÿï¼ˆå°æ—¶/ä½“ç§¯/é‡é‡ï¼‰

ğŸ‘¤ ä½ : ææ–™æ˜¯ AlSi9Mnï¼Œå¹´äº§ 110 ä¸‡ä»¶ï¼Œä½“ç§¯ 195.6 cmÂ³ï¼ŒæŒ‰å°æ—¶è®¡è´¹

ğŸ¤– Agent: [è°ƒç”¨å·¥å…·æŸ¥è¯¢...]
```

#### åœºæ™¯ 3: å¤šå·¥åºå¯¹æ¯”
```
ğŸ‘¤ ä½ : å¯¹æ¯”ä¸€ä¸‹ Casting å’Œ Melting è¿™ä¸¤ä¸ªå·¥è‰ºçš„æˆæœ¬

ğŸ¤– Agent: å¥½çš„ï¼Œæˆ‘éœ€è¦ä»¥ä¸‹ä¿¡æ¯æ¥å¯¹æ¯”è¿™ä¸¤ä¸ªå·¥è‰ºï¼š
  1. ç”Ÿäº§åœ°åŒºï¼Ÿ
  2. ææ–™åç§°ï¼Ÿ
  3. é›¶ä»¶å‚æ•°ï¼ˆè¡¨é¢ç§¯ã€ä½“ç§¯ï¼‰ï¼Ÿ
  4. å¹´äº§é‡ï¼Ÿ
  5. è®¡è´¹å•ä½ï¼Ÿï¼ˆå»ºè®® Melting ç”¨ CNY/kgï¼ŒCasting ç”¨ CNY/hï¼‰
```

---

## ğŸ¨ åŠŸèƒ½ç‰¹æ€§

### 1. æ™ºèƒ½å‚æ•°æ¨ç†

Agent å¯ä»¥åŸºäºå¸¸è¯†æ¨ç†ç¼ºå¤±å‚æ•°ï¼š

```python
ç”¨æˆ·: "å¸®æˆ‘ç®—å‹é“¸æˆæœ¬ï¼Œææ–™ AlSi9Mnï¼Œå¹´äº§ 100 ä¸‡ä»¶"

Agent æ¨ç†:
  â†’ ç¼ºå°‘è¡¨é¢ç§¯å’Œä½“ç§¯
  â†’ åŸºäºå…¸å‹é“åˆé‡‘å‹é“¸ä»¶å°ºå¯¸ä¼°ç®—
  â†’ æˆ–å¼•å¯¼ç”¨æˆ·æä¾›
```

### 2. å¤šè½®å¯¹è¯è®°å¿†

Agent è®°ä½ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒè¿ç»­å¯¹è¯ï¼š

```
ğŸ‘¤: å®æ³¢çš„ Trimming æˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ
ğŸ¤–: [æŸ¥è¯¢ç»“æœ] 150 CNY/h

ğŸ‘¤: é‚£ Casting å‘¢ï¼Ÿ
ğŸ¤–: [è‡ªåŠ¨ç»§æ‰¿åœ°åŒº "å®æ³¢"] [æŸ¥è¯¢ Casting] 180 CNY/h

ğŸ‘¤: å¯¹æ¯”ä¸€ä¸‹è¿™ä¸¤ä¸ªå·¥è‰º
ğŸ¤–: Trimming (150) vs Casting (180)ï¼ŒTrimming ä¾¿å®œ 16.7%
```

### 3. æ ¼å¼åŒ–è¾“å‡º

Agent è‡ªåŠ¨æ ¼å¼åŒ–å·¥å…·è¿”å›çš„ JSONï¼š

```
ğŸ“Š æˆæœ¬æŸ¥è¯¢ç»“æœ
--------------------------------------------------
ğŸ” æŸ¥è¯¢å‚æ•°: ...
ğŸ’° æˆæœ¬ä¼°ç®—: ...
ğŸ“‹ æˆæœ¬åˆ†è§£: ...
ğŸ“š CSV åŸºå‡†æ•°æ®: ...
ğŸ§  æ¨ç†è¿‡ç¨‹: ...
```

### 4. é”™è¯¯å¤„ç†

Agent æ™ºèƒ½å¤„ç†å„ç§å¼‚å¸¸ï¼š

```python
# å·¥å…·è°ƒç”¨å¤±è´¥
ğŸ¤–: "æŠ±æ­‰ï¼ŒæŸ¥è¯¢è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯èƒ½æ˜¯ç½‘ç»œè¿æ¥æˆ– API é…é¢ä¸è¶³ã€‚è¯·ç¨åé‡è¯•ã€‚"

# å‚æ•°ä¸åˆç†
ğŸ¤–: "å¹´äº§é‡ 0 ä»¶ä¸åˆç†ï¼Œè¯·æä¾›æœ‰æ•ˆçš„å¹´äº§é‡ï¼ˆé€šå¸¸ > 1000 ä»¶ï¼‰"

# ç¼ºå°‘å…³é”®å‚æ•°
ğŸ¤–: "ä¸ºäº†å‡†ç¡®ä¼°ç®—æˆæœ¬ï¼Œæˆ‘éœ€è¦ä»¥ä¸‹ä¿¡æ¯ï¼š..."
```

---

## ğŸ“– ç¤ºä¾‹åœºæ™¯

### åœºæ™¯ 1: å•ä¸ªå·¥è‰ºæŸ¥è¯¢

```python
from process_cost_agent import ProcessCostAgent

agent = ProcessCostAgent()

response = agent.chat(
    "æŸ¥è¯¢å®æ³¢ AlSi9Mn ææ–™çš„ KTL coating æˆæœ¬ï¼Œ"
    "è¡¨é¢ç§¯ 3110 cmÂ²ï¼Œä½“ç§¯ 195.6 cmÂ³ï¼Œå¹´äº§ 110 ä¸‡ä»¶ï¼ŒæŒ‰ä½“ç§¯è®¡è´¹"
)

print(response)
```

### åœºæ™¯ 2: æˆæœ¬å¯¹æ¯”åˆ†æ

```python
agent = ProcessCostAgent()

# ç¬¬ä¸€æ¬¡æŸ¥è¯¢
agent.chat("æŸ¥è¯¢å®æ³¢çš„ Melting æˆæœ¬ï¼ŒAlSi9Mnï¼Œå¹´äº§ 110 ä¸‡ä»¶ï¼ŒæŒ‰é‡é‡è®¡è´¹")

# ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ç»§æ‰¿ä¸Šä¸‹æ–‡ï¼‰
agent.chat("é‚£ Casting å·¥è‰ºå‘¢ï¼ŸæŒ‰å°æ—¶è®¡è´¹")

# å¯¹æ¯”åˆ†æ
agent.chat("å¯¹æ¯”ä¸€ä¸‹è¿™ä¸¤ä¸ªå·¥è‰ºå“ªä¸ªæ›´ç»æµï¼Ÿ")
```

### åœºæ™¯ 3: æ‰¹é‡æŸ¥è¯¢

```python
agent = ProcessCostAgent()

processes = [
    "Melting (CNY/kg)",
    "Casting (CNY/h)",
    "Machining OP10 (CNY/h)",
    "Machining OP20 (CNY/h)",
    "KTL coating (CNY/cmÂ³)",
]

for process in processes:
    agent.chat(f"æŸ¥è¯¢å®æ³¢ AlSi9Mn ææ–™çš„ {process} æˆæœ¬ï¼Œå¹´äº§ 110 ä¸‡ä»¶")
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: Agent å“åº”å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

**åŸå› **: Tavily æœç´¢ + LLM æ¨ç†éœ€è¦æ—¶é—´

**è§£å†³æ–¹æ¡ˆ**:
- è°ƒä½ `temperature` å‚æ•°ï¼ˆæ›´å¿«ä½†æ›´ä¿å®ˆï¼‰
- ä½¿ç”¨æ›´å¿«çš„ Azure OpenAI æ¨¡å‹
- æå‰å‡†å¤‡å¥½å®Œæ•´å‚æ•°ï¼Œå‡å°‘å¤šè½®å¯¹è¯

### Q2: Agent ä¸€ç›´è¯¢é—®å‚æ•°ï¼Œæ— æ³•å®ŒæˆæŸ¥è¯¢ï¼Ÿ

**åŸå› **: ç¼ºå°‘å…³é”®ä¿¡æ¯ä¸” Agent æ— æ³•æ¨ç†

**è§£å†³æ–¹æ¡ˆ**:
- ä¸€æ¬¡æ€§æä¾›å®Œæ•´ä¿¡æ¯
- ä½¿ç”¨å…·ä½“æ•°å€¼è€Œéæ¨¡ç³Šæè¿°
- ç¤ºä¾‹ï¼šâŒ "å°å‹é›¶ä»¶" â†’ âœ… "ä½“ç§¯ 200 cmÂ³"

### Q3: å¦‚ä½•æŸ¥çœ‹ Agent çš„å†…éƒ¨æ¨ç†è¿‡ç¨‹ï¼Ÿ

åœ¨åˆå§‹åŒ–æ—¶è®¾ç½® `verbose=True`ï¼š

```python
self.agent_executor = AgentExecutor(
    agent=self.agent,
    tools=self.tools,
    verbose=True,  # æ‰“å°è¯¦ç»†æ—¥å¿—
    ...
)
```

### Q4: Agent å¯ä»¥åŒæ—¶å¯¹æ¯”å¤šä¸ªåœ°åŒºå—ï¼Ÿ

å¯ä»¥ï¼ç¤ºä¾‹ï¼š

```
ğŸ‘¤: å¯¹æ¯”å®æ³¢ã€è‹å·ã€ä¸œèä¸‰ä¸ªåœ°åŒºçš„ Casting æˆæœ¬
ğŸ¤–: [ä¾æ¬¡æŸ¥è¯¢ä¸‰ä¸ªåœ°åŒº] 
    å®æ³¢: 180 CNY/h
    è‹å·: 195 CNY/h
    ä¸œè: 165 CNY/h
    å»ºè®®: ä¸œèæœ€ç»æµ
```

### Q5: å¦‚ä½•å¯¼å‡ºå¯¹è¯å†å²ï¼Ÿ

```python
agent = ProcessCostAgent()

# ... å¤šè½®å¯¹è¯ ...

# å¯¼å‡ºå†å²
import json
with open("chat_history.json", "w", encoding="utf-8") as f:
    history = [
        {"role": "user" if isinstance(msg, HumanMessage) else "assistant",
         "content": msg.content}
        for msg in agent.chat_history
    ]
    json.dump(history, f, ensure_ascii=False, indent=2)
```

---

## ğŸ› ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰ Agent è¡Œä¸º

ä¿®æ”¹ `_create_prompt()` ä¸­çš„ `system_template`ï¼š

```python
system_template = """
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„åˆ¶é€ ä¸šæˆæœ¬å·¥ç¨‹å¸ˆåŠ©æ‰‹ã€‚

é¢å¤–èƒ½åŠ›ï¼š
- è€ƒè™‘è®¾å¤‡åˆ©ç”¨ç‡å¯¹æˆæœ¬çš„å½±å“
- æä¾›ä¾›åº”å•†è°ˆåˆ¤å»ºè®®
- é¢„æµ‹æœªæ¥ä»·æ ¼è¶‹åŠ¿

...
"""
```

### æ·»åŠ æ›´å¤šå·¥å…·

```python
from your_tool import MaterialPriceTool, SupplierComparisonTool

self.tools = [
    self.tool.as_tool(),
    MaterialPriceTool().as_tool(),
    SupplierComparisonTool().as_tool(),
]
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- ğŸ“§ Email: your-email@company.com
- ğŸ’¬ å†…éƒ¨ Slack: #manufacturing-cost-tool

---

**Version**: 1.0  
**Last Updated**: 2025-11-13  
**Author**: Your Team
